{
    "version": "1.19.40.02",
    "description": "Bedrock Dedicated Server for Minecraft",
    "homepage": "https://www.minecraft.net/en-us/download/server/bedrock",
    "license": {
        "identifier": "Proprietary",
        "url": "https://www.minecraft.net/en-us/terms"
    },
    "depends": "nssm",
    "url": "https://minecraft.azureedge.net/bin-win/bedrock-server-1.19.40.02.zip",
    "hash": "3cd999ffbfc312e724a273f4779d968d7b4ba9618d6373b6666797e154dfe6ee",
    "notes": [
        "Bedrock Server has been set as a service, it will automatically start when the system starts.",
        "Set Bedrock Server's startup type to maunal by running: nssm set 'Bedrock Server' Start SERVICE_DEMAND_START",
        "Start Bedrock Server by running: nssm start 'Bedrock Server'",
        "Stop Bedrock Server by running: nssm stop 'Bedrock Server'",
        "Restart Bedrock Server by running: nssm restart 'Bedrock Server'",
        "Querying the service's status by running: nssm status 'Bedrock Server'"
    ],
    "persist": [
        "allowlist.json",
        "permissions.json",
        "server.properties",
        "worlds"
    ],
    "pre_install": [
        "if(!(Test-Path \"$dir/allowlist.json\")) { Add-Content \"$dir/allowlist.json\" $null }",
        "if(!(Test-Path \"$dir/permissions.json\")) { Add-Content \"$dir/permissions.json\" $null }",
        "if(!(Test-Path \"$dir/server.properties\")) { Add-Content \"$dir/server.properties\" $null }",
        "",
        "if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {",
        "    Start-Process PowerShell -Verb RunAs \"-NoProfile -ExecutionPolicy Bypass -Command `\"nssm install 'Bedrock Server' '$dir\\bedrock_server.exe'; nssm set 'Bedrock Server' Start SERVICE_DELAYED_AUTO_START; nssm set 'Bedrock Server' AppPriority ABOVE_NORMAL_PRIORITY_CLASS`\"\"",
        "} else {",
        "    nssm install 'Bedrock Server' \"$dir/bedrock_server.exe\"; nssm set 'Bedrock Server' Start SERVICE_DELAYED_AUTO_START; nssm set 'Bedrock Server' AppPriority ABOVE_NORMAL_PRIORITY_CLASS",
        "}"
    ],
    "uninstaller": {
        "script": [
            "$service = Get-Service -Name \"Bedrock Server\" -ErrorAction SilentlyContinue",
            "if ($service -ne $null) {",
            "    if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {",
            "        Start-Process PowerShell -Verb RunAs \"-NoProfile -ExecutionPolicy Bypass -Command `\"nssm stop 'Bedrock Server'; nssm remove 'Bedrock Server'`\"\"",
            "   } else {",
            "       nssm stop 'Bedrock Server'; nssm remove 'Bedrock Server'",
            "   }",
            "}"
        ]
    },
    "checkver": {
        "url": "https://minecraft.fandom.com/wiki/Bedrock_Dedicated_Server",
        "regex": "bin-win/bedrock-server-([\\d\\.]+)\\.zip",
        "reverse": true
    },
    "autoupdate": {
        "url": "https://minecraft.azureedge.net/bin-win/bedrock-server-$version.zip"
    }
}
